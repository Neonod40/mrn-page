<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MRN Checker</title>
  <link rel="icon" href="https://img.icons8.com/fluency/48/container-truck.png" type="image/png">
  
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1e40af;
      --danger: #ef4444;
      --success: #16a34a;
      --bg-gradient: linear-gradient(135deg, #dbeafe, #f0f9ff);
      --card-shadow: 0 4px 20px rgba(0,0,0,0.08);
      --border: #cbd5e1;
      --text: #1e293b;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: var(--bg-gradient);
      min-height: 100vh;
      padding: 30px 15px;
      color: var(--text);
      display: flex;
      flex-direction: column;
    }

    #container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 2.5fr;
      gap: 30px;
      flex: 1;
    }

    .card {
      background: white;
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      padding: 24px;
    }

    h3 {
      margin-bottom: 16px;
      color: #1e3a8a;
      font-size: 19px;
    }

    textarea {
      width: 100%;
      height: 280px;
      padding: 14px;
      border: 1px solid var(--border);
      border-radius: 12px;
      font-size: 15px;
      resize: vertical;
      outline: none;
      transition: border 0.2s;
    }
    textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
    }

    .btn-group {
      display: flex;
      gap: 10px;
      margin-top: 16px;
      flex-wrap: wrap;
    }

    button {
      padding: 12px 18px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn-danger { background: var(--danger); color: white; }
    .btn-success { background: var(--success); color: white; }

    #result-container {
      min-height: 100px;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      min-width: 500px;
    }
    th {
      background: #eff6ff;
      padding: 12px 10px;
      text-align: left;
      color: #1e3a8a;
      font-weight: 600;
      border-bottom: 2px solid #dbeafe;
    }
    td {
      padding: 10px;
      border-bottom: 1px solid #e2e8f0;
    }
    tr:hover td { background: #f8fafc; }

    #loader {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 24px 48px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      font-size: 18px;
      color: #1e3a8a;
      z-index: 999;
      display: none;
    }

    #quote {
      text-align: center;
      padding: 20px;
      font-style: italic;
      color: #475569;
      font-size: 15px;
      margin: 30px auto 10px;
      max-width: 800px;
    }

    footer {
      text-align: center;
      padding: 20px;
      color: #64748b;
      font-size: 14px;
    }
    footer strong {
      color: #1e293b;
      font-weight: 600;
    }

    @media (max-width: 900px) {
      #container { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <div id="container">
    <div class="card">
      <h3>Номера контейнеров (по одному на строку)</h3>
      <textarea id="input" placeholder="TCKU1234567&#10;MRKU1234567&#10;MSKU1234567"></textarea>
      <div class="btn-group">
        <button class="btn-primary" onclick="processContainers()">Получить MRN</button>
        <button class="btn-danger" onclick="clearAll()">Очистить</button>
        <button class="btn-success" onclick="exportTable()">Экспорт CSV</button>
      </div>
    </div>

    <div class="card">
      <h3>Результат</h3>
      <div id="result-container">
        <div id="output"></div>
      </div>
    </div>
  </div>

  <div id="quote">«Мудрость начинается с удивления.» — Сократ</div>

  <footer>
    <div>created by <strong>NEON</strong></div>
    <div>2025</div>
  </footer>

  <div id="loader">Загрузка MRN...</div>

  <script>
    const API_URL = "https://mrn-proxy.vercel.app/api/get-mrn";

    const quotes = [
      "«Мудрость начинается с удивления.» — Сократ",
      "«Я знаю, что ничего не знаю.» — Сократ",
      "«Однажды прожитая жизнь стоит тысячи прочитанных книг.» — Конфуций",
      "«Не тот велик, кто никогда не падал, а тот, кто падал и вставал.» — Конфуций",
      "«Цель жизни — жить в согласии с природой.» — Зенон из Китиона",
      "«Мы есть то, что мы неоднократно делаем.» — Аристотель",
      "«Терпение — спутник мудрости.» — Августин Блаженный",
      "«Человек — мера всех вещей.» — Протагор",
      "«Нельзя дважды войти в одну и ту же реку.» — Гераклит",
      "«Познай самого себя.» — Надпись в храме Аполлона в Дельфах"
    ];

    // Рандомная цитата при загрузке
    document.getElementById("quote").textContent = quotes[Math.floor(Math.random() * quotes.length)];

    async function getMRN(container) {
      try {
        const res = await fetch(`${API_URL}?number=${encodeURIComponent(container.trim())}`);
        if (!res.ok) return "Ошибка сервера";
        const data = await res.json();
        return data.mrn || data.result || "Не найдено";
      } catch (err) {
        return "Нет связи";
      }
    }

    async function processContainers() {
      const input = document.getElementById("input").value.trim();
      if (!input) return alert("Вставьте хотя бы один номер контейнера");

      const containers = input.split(/\s*\n+\s*/).filter(Boolean);
      const loader = document.getElementById("loader");
      const output = document.getElementById("output");

      loader.style.display = "block";
      output.innerHTML = "";

      let html = `<table><tr><th>Контейнер</th><th>MRN</th></tr>`;

      for (const container of containers) {
        const mrn = await getMRN(container);
        const rowClass = mrn.includes("Ошибка") || mrn === "Не найдено" ? 'style="color:#ef4444"' : '';
        html += `<tr><td>${escapeHtml(container)}</td><td ${rowClass}>${escapeHtml(mrn)}</td></tr>`;
      }

      html += "</table>";
      output.innerHTML = html;
      loader.style.display = "none";
    }

    function clearAll() {
      document.getElementById("input").value = "";
      document.getElementById("output").innerHTML = "";
    }

    function exportTable() {
      const table = document.querySelector("#output table");
      if (!table) return alert("Сначала получите результаты");

      let csv = [];
      for (let row of table.rows) {
        let cells = Array.from(row.cells).map(cell => 
          `"${cell.innerText.replace(/"/g, '""')}"`
        );
        csv.push(cells.join(','));
      }

      const blob = new Blob([csv.join('\n')], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `MRN_${new Date().toISOString().slice(0,10)}.csv`;
      a.click();
      URL.revokeObjectURL(url);
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Enter в textarea = запуск проверки
    document.getElementById("input").addEventListener("keydown", e => {
      if (e.ctrlKey && e.key === "Enter") processContainers();
    });
  </script>
</body>
</html>
